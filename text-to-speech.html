<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-Speech with Pause, Resume, and Stop</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        textarea {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }

        button:hover {
            background-color: #45a049;
        }
    </style>
<script defer="" data-domain="speech-to-text94.tiiny.site" src="https://analytics.tiiny.site/js/plausible.js"></script></head>

<body>
    <h1>Text-to-Speech and Speech-to-Text Demo</h1>
    <p>Enter text below and click "Speak" to hear it read aloud or use "Start Listening" to convert your speech to text.
    </p>
    <textarea id="textToSpeak" placeholder="Type or dictate your text here..."></textarea>
    <br>
    <button onclick="speakText()">üîä Speak</button>
    <button onclick="pauseSpeech()">‚è∏Ô∏è Pause</button>
    <button onclick="resumeSpeech()">‚ñ∂Ô∏è Resume</button>
    <button onclick="startListening()">Start Listening</button>
    <button onclick="stopListening()">Stop Listening</button>
    <p id="status" style="margin-top: 10px; color: #888;"></p>

    <script>
        let currentChunkIndex = 0;
        let sentences = [];
        let isPaused = false;
        let lastSpokenCharIndex = 0;
        let currentUtterance = null; // Store the current speech utterance for pausing/resuming

        function speakText() {
            const text = document.getElementById("textToSpeak").value;

            if (!text.trim()) {
                alert("Please enter some text.");
                return;
            }

            window.speechSynthesis.cancel();  // Cancel any ongoing speech
            currentChunkIndex = 0;
            isPaused = false;
            lastSpokenCharIndex = 0;
            currentUtterance = null;  // Reset the current utterance reference

            sentences = text.match(/[^.!?]+[.!?]+|[^.!?]+$/g);  // Split the text into sentences/chunks
            if (!sentences) {
                alert("Unable to process the text.");
                return;
            }

            speakChunks();
        }

        function speakChunks() {
            if (currentChunkIndex >= sentences.length) {
                console.log("Speech finished.");
                return;
            }

            const textToSpeak = sentences[currentChunkIndex].trim();

            // Avoiding problematic repetitive characters, replace sequences of repeated characters with a space
            const sanitizedText = textToSpeak.replace(/(\d)\1{45,}/g, '$1...');

            const speech = new SpeechSynthesisUtterance(sanitizedText.substring(lastSpokenCharIndex));
            speech.lang = "en-US";

            currentUtterance = speech;  // Set the current utterance

            speech.onboundary = (event) => {
                if (event.name === "word") {
                    lastSpokenCharIndex = event.charIndex;
                }
            };

            speech.onend = () => {
                if (!isPaused) {
                    lastSpokenCharIndex = 0;  // Reset the character index for the next chunk
                    currentChunkIndex++;
                    speakChunks();  // Continue speaking the next chunk
                }
            };

            speech.onerror = (event) => {
                console.error("Speech error:", event);
                currentChunkIndex++;
                speakChunks();  // Continue speaking the next chunk if an error occurs
            };

            window.speechSynthesis.speak(speech);
        }

        function pauseSpeech() {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.pause();
                isPaused = true;  // Mark the speech as paused
                console.log('Speach is paused');
            }
        }

        function resumeSpeech() {
            if (isPaused) {
                // Resume from the current paused utterance (keep track of the current state)
                window.speechSynthesis.resume();
                isPaused = false;
                console.log('is paused the utterance the tracke');
            } else if (!window.speechSynthesis.speaking && currentChunkIndex < sentences.length) {
                // If not speaking and the sentence is finished, resume from the current chunk
                console.log('iiiiii');
                speakChunks();
            }
        }



        // Speech-to-Text
        let recognition;
        function startListening() {
            if (!('webkitSpeechRecognition' in window)) {
                alert('Your browser does not support speech recognition.');
                return;
            }

            if (!recognition) {
                recognition = new webkitSpeechRecognition();
                recognition.lang = 'en-US';
                recognition.interimResults = true;
                recognition.continuous = true;

                recognition.onresult = (event) => {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript;
                    }
                    document.getElementById('textToSpeak').value = transcript.trim();
                };

                recognition.onstart = () => {
                    document.getElementById('status').innerText = 'Listening...';
                };

                recognition.onend = () => {
                    document.getElementById('status').innerText = 'Stopped listening.';
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event);
                    document.getElementById('status').innerText = 'Error occurred during recognition.';
                };
            }

            recognition.start();
        }

        function stopListening() {
            if (recognition) {
                recognition.stop();
            }
        }


    </script>


</body></html>